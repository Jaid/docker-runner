name: bumpDocker
on:
  workflow_dispatch:
    inputs:
      bumpAmount:
        description: Bump amount
        required: true
        default: patch
        type: choice
        options:
          - patch
          - minor
          - major
jobs:
  matrix:
    uses: ./.github/workflows/makeMatrix.yml
  bump:
    permissions:
      contents: write
    uses: jaid/workflows/.github/workflows/bump.yml@main
    with:
      bumpAmount: ${{ inputs.bumpAmount }}
  pushDocker:
    name: push${{ matrix.id && format(' ({0})', matrix.id) }}
    permissions:
      packages: write
      contents: read
    needs:
      - bump
      - matrix
    strategy:
      fail-fast: false
      matrix:
        include: ${{ fromJson(needs.matrix.outputs.output) }}
    uses: jaid/workflows/.github/workflows/pushDocker.yml@main
    with:
      dockerHubUser: jaidchen
      buildArgs: image=${{ matrix.base }}
      arch: ${{ matrix.platform }}
      flavorSuffix: ${{ matrix.id }}
      versionTag: ${{ needs.bump.outputs.newSemver }}
    secrets:
      dockerHubToken: ${{ secrets.dockerHubToken }}