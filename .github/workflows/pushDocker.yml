name: pushDocker
on:
  push:
    branches:
      - main
  schedule:
    - cron: 45 23 * * 0 # https://crontab.guru/#45_23_*_*_0
jobs:
  test:
    name: Test Docker
    permissions:
      contents: read
    uses: jaid/workflows/.github/workflows/testDocker.yml@main
    with:
      test: stdout.includes('run.bash not found')
  pushDocker:
    needs: test
    strategy:
      matrix:
        include:
          - image: ubuntu:rolling
          - flavorSuffix: lts
            builderFlavor: -lts
            image: ubuntu:latest
          - flavorSuffix: debian
            builderFlavor: -debian
            image: debian:stable-slim
    uses: jaid/workflows/.github/workflows/pushDocker.yml@main
    with:
      dockerHubUser: jaidchen
      arch: linux/amd64,linux/arm64/v8
      buildArgs: |
        image=${{ matrix.image }}
        builderFlavor=${{ matrix.builderFlavor }}
      flavorSuffix: ${{ matrix.flavorSuffix }}
    secrets:
      dockerHubToken: ${{ secrets.dockerHubToken }}
